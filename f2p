#!/usr/bin/env python3

import argparse
import os
import sys

def is_text_file(filepath):
    try:
        with open(filepath, 'rb') as f:
            chunk = f.read(1024)
            chunk.decode('utf-8')  # try decoding to check if it's text
        return True
    except UnicodeDecodeError:
        return False
    except Exception as e:
        print(f"Error reading file {filepath}: {e}", file=sys.stderr)
        return False

def main():
    parser = argparse.ArgumentParser(description='Read and output contents of text files specified with -o.')
    parser.add_argument('-o', action='append', dest='output_files', help='Path to a text file', required=False)

    args = parser.parse_args()

    if not args.output_files:
        print("Error: No -o options specified", file=sys.stderr)
        sys.exit(1)

    for filepath in args.output_files:
        if not os.path.exists(filepath):
            print(f"Error: File does not exist: {filepath}", file=sys.stderr)
            sys.exit(1)
        if not os.path.isfile(filepath):
            print(f"Error: Not a file: {filepath}", file=sys.stderr)
            sys.exit(1)
        if not is_text_file(filepath):
            print(f"Error: File is not a text file: {filepath}", file=sys.stderr)
            sys.exit(1)

        print(f"## {filepath}\n")
        with open(filepath, 'r', encoding='utf-8') as f:
            print(f.read())

if __name__ == '__main__':
    main()

